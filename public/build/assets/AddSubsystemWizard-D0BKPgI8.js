import{r,j as e,a as N}from"./app-CrM3bAr7.js";import{B as c}from"./button-DSYtEUz-.js";import{D as B,a as L,b as R,c as W,d as _,e as q}from"./dialog-13Vh7iYP.js";import{I as C}from"./input-BwgTVrff.js";import{L as S}from"./label-Dif50TA4.js";import{X as H}from"./x-DprXbeJV.js";import"./index-C7o-dAq6.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-BYkqkD9G.js";import"./index-DCk08MMz.js";import"./index-C07_Bs9F.js";import"./tslib.es6-CMwweBXX.js";import"./createLucideIcon-BQ0uF5zu.js";const K=({currentStep:x})=>{const h=["Subsystem Details","Add Inspection Points"];return e.jsx("div",{className:"flex justify-center space-x-4 text-sm",children:h.map((l,y)=>{const n=y+1,a=x===n;return e.jsxs("span",{className:a?"font-bold text-primary":"text-muted-foreground",children:[n,". ",l]},n)})})};function ne({machineId:x,isOpen:h,onOpenChange:l,onFinish:y}){const[n,a]=r.useState(1),[d,v]=r.useState(null),[i,m]=r.useState(!1),[w,P]=r.useState(""),[D,f]=r.useState({}),[p,j]=r.useState(""),[o,b]=r.useState([]),[T,g]=r.useState({}),A=async s=>{s.preventDefault(),m(!0),f({});try{let t;const u={name:w};d?t=await N.put(route("subsystems.update",d),u):t=await N.post(route("subsystems.add",x),u),v(t.data.id),a(2)}catch(t){t.response&&t.response.status===422?f(t.response.data.errors):console.error("An unexpected error occurred:",t)}finally{m(!1)}},I=()=>{p.trim()!==""&&!o.includes(p.trim())&&(b([...o,p.trim()]),j(""))},E=s=>{b(o.filter((t,u)=>u!==s))},F=async()=>{if(d){m(!0),g({});try{await N.post(route("inspection-points.store"),{inspection_points:{[d]:o}}),k()}catch(s){s.response&&s.response.status===422?g(s.response.data.errors):console.error("An unexpected error occurred:",s)}finally{m(!1)}}},k=()=>{P(""),b([]),j(""),f({}),g({}),a(1),v(null),l(!1),y()},z=()=>{switch(n){case 1:return e.jsx("form",{id:"subsystem-form",onSubmit:A,className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"subsystem-name",children:"Subsystem Name"}),e.jsx(C,{className:"bg-gray-100",id:"subsystem-name",value:w,onChange:s=>P(s.target.value),required:!0,autoFocus:!0}),D.name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:D.name[0]})]})});case 2:return e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"inspection-point-name",children:"Inspection Point Name"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(C,{className:"bg-gray-100",id:"inspection-point-name",value:p,onChange:s=>j(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),I())}}),e.jsx(c,{type:"button",onClick:I,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Added Points"}),o.length>0?e.jsx("div",{className:"max-h-48 space-y-2 overflow-y-auto rounded-sm border p-2",children:o.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between rounded-sm bg-primary p-2 text-primary-foreground",children:[e.jsx("span",{children:s}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>E(t),children:e.jsx(H,{className:"h-4 w-4"})})]},t))}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No inspection points added yet."})]})]});default:return null}};return e.jsx(B,{open:h,onOpenChange:l,children:e.jsxs(L,{children:[e.jsxs(R,{children:[e.jsx(W,{children:"Add New Subsystem"}),e.jsx(_,{children:"Follow the steps to add a new subsystem and its inspection points."})]}),e.jsx("div",{className:"p-4",children:e.jsx(K,{currentStep:n})}),z(),e.jsxs(q,{children:[n>1&&e.jsx(c,{variant:"outline",onClick:()=>a(n-1),disabled:i,children:"Back"}),n===1&&e.jsx(c,{type:"submit",form:"subsystem-form",disabled:i,children:i?"Saving...":"Save and Continue"}),n===2&&e.jsx(c,{onClick:F,disabled:i,children:i?"Saving...":"Finish"})]})]})})}export{ne as AddSubsystemWizard};
