import{r as m,j as o,L as M,a as P,S as v}from"./app-CrM3bAr7.js";import{B as x}from"./button-DSYtEUz-.js";import{A as E}from"./app-layout-CK9_8PlX.js";import{ChecklistCard as O}from"./CheckListCard-JnudB0l5.js";import{ExistingTicketsModal as $}from"./ExistingTicketsModal-CY0BRQ8t.js";import{SummaryCard as w}from"./SummaryCard-B4GMNQ9u.js";import"./index-C7o-dAq6.js";import"./index-DZZQifJx.js";import"./utils-jAU0Cazi.js";import"./index-BYkqkD9G.js";import"./index-DCk08MMz.js";import"./index-C07_Bs9F.js";import"./tslib.es6-CMwweBXX.js";import"./x-DprXbeJV.js";import"./createLucideIcon-BQ0uF5zu.js";import"./tooltip-DWc-CuE-.js";import"./index-ChLr_mRA.js";import"./index-CipIuUZM.js";import"./index-GEmL2IxC.js";import"./index-Dyr2mIP4.js";import"./index-6v8HNz3P.js";import"./floating-ui.react-dom-D6wYppxE.js";import"./index-fR5QWmBt.js";import"./index-rQBWhrbd.js";import"./index-Dd5Vhwor.js";import"./index-CFGBrPdz.js";import"./dropdown-menu-D615tSEK.js";import"./index-Cxnn9A7l.js";import"./check-BKXQxHa7.js";import"./user-avatar-CalEyW6r.js";import"./chevrons-up-down-CqP_Vf3P.js";import"./shield-check-0vfauCFM.js";import"./chevron-right-B5DMNuK2.js";import"./badge-IgYfdO9V.js";import"./separator-C07NZpcB.js";import"./accordion-CCdQnk3G.js";import"./chevron-down-BZjTBYLj.js";import"./card-jCh-kFsa.js";import"./InspectionPointRow-C4Vh0Xfn.js";import"./input-BwgTVrff.js";import"./label-Dif50TA4.js";import"./select-ZNRTKmmh.js";import"./index-D9YkVoQb.js";import"./textarea-BH7YRjF0.js";import"./circle-x-CyllH9Co.js";import"./circle-alert-BpGn1koC.js";import"./carousel-G-04oJan.js";import"./dialog-13Vh7iYP.js";import"./TicketMiniCard-DrpOBLjb.js";import"./wrench-D9uW3F3T.js";import"./clock-arrow-up-ClzO97On.js";import"./clock-BrxB6LzT.js";function $t({report:u,inspectionStatuses:c,uptime:S}){const{machine:n}=u,[r,k]=m.useState({}),[f,g]=m.useState(!1),[j,h]=m.useState(!1),[y,b]=m.useState([]),[l,C]=m.useState(null),d=(i,t)=>{k(e=>({...e,[i]:t}))},_=async(i,t)=>{const e={...r[i],status_id:t};d(i,e);const a=c.find(p=>p.id===t);if(a&&a.severity>0){const p=n.subsystems.flatMap(s=>s.inspection_points).find(s=>s.id===i);if(p)try{const s=await P.get(route("inspection-points.open-tickets",p.id));s.data.length>0&&(b(s.data),C(p),h(!0))}catch(s){console.error("Failed to fetch open tickets:",s)}}},R=i=>{l&&d(l.id,{...r[l.id],pinged_ticket_id:i.id,comment:`Ping to existing Ticket #${i.id}.`,image:null})},T=()=>{for(const i of n.subsystems.flatMap(t=>t.inspection_points)){const t=r[i.id];if(!(t!=null&&t.status_id)){alert(`Please select a status for all inspection points. Missing status for: ${i.name}`);return}if(!t.pinged_ticket_id&&!t.image){alert(`A photo is required for all inspection points. Missing photo for: ${i.name}`);return}const e=c.find(a=>a.id===t.status_id);if(e&&e.severity>0&&!t.comment){alert(`A comment is required for points with issues. Missing comment for: ${i.name}`);return}}g(!0),v.post(route("inspections.update",u.id),{_method:"put",results:r},{onFinish:()=>g(!1)})};return o.jsxs(E,{breadcrumbs:[],children:[o.jsx(M,{title:`Inspecting: ${n.name}`}),o.jsxs("div",{className:"space-y-6 p-6",children:[o.jsx(w,{machine:n,uptime:S}),o.jsx(O,{machine:n,inspectionStatuses:c,inspectionResults:r,onResultChange:d,onStatusChange:_}),o.jsxs("div",{className:"flex justify-end space-x-4",children:[o.jsx(x,{variant:"secondary",children:"Cancel"}),o.jsx(x,{onClick:T,disabled:f,children:f?"Submitting...":"Submit Inspection"})]})]}),o.jsx($,{isOpen:j,onOpenChange:h,onPing:R,onReportNew:()=>{},openTickets:y})]})}export{$t as default};
