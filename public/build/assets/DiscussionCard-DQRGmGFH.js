import{r as h,m as x,j as s}from"./app-CrM3bAr7.js";import{I as f}from"./input-error-B-ImtbXT.js";import{B as g}from"./button-DSYtEUz-.js";import{C as j,a as _,b as N,c as w}from"./card-jCh-kFsa.js";import{I as v}from"./input-BwgTVrff.js";import{U as y}from"./user-avatar-CalEyW6r.js";import{c as b}from"./createLucideIcon-BQ0uF5zu.js";import{S as C}from"./send-WmHc0PdS.js";import"./utils-jAU0Cazi.js";import"./index-C7o-dAq6.js";import"./index-DZZQifJx.js";import"./index-Dyr2mIP4.js";import"./index-CipIuUZM.js";import"./index-fR5QWmBt.js";import"./index-GEmL2IxC.js";import"./index-DCk08MMz.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],S=b("MessageCircle",I);function $({ticket:r}){const o=h.useMemo(()=>{const e=[],a=r.updates.find(t=>!t.old_status&&t.new_status);return a&&e.push(a),r.description&&e.push({id:`initial-${r.id}`,user:r.creator,comment:r.description,created_at:r.created_at,is_initial:!0,action_taken:null,parts_used:null,old_status:null,new_status:null,new_machine_status_id:null,new_machine_status:null}),r.updates.forEach(t=>{t.comment&&!t.comment.startsWith("Ping:")&&!t.comment.startsWith("System:")&&!t.comment.startsWith("Sent a part request")&&t.id!==(a==null?void 0:a.id)&&e.push(t)}),e.sort((t,u)=>new Date(t.created_at).getTime()-new Date(u.created_at).getTime())},[r]),{data:m,setData:i,post:c,processing:n,errors:l,reset:d}=x({comment:""}),p=e=>{e.preventDefault(),c(route("tickets.updates.store",r.id),{onSuccess:()=>d("comment")})};return s.jsxs(j,{className:"transition-500 overflow-y-auto shadow-lg drop-shadow-lg transition-transform ease-in-out hover:-translate-1",children:[s.jsx(_,{children:s.jsx(N,{className:"flex items-center gap-2",children:s.jsxs(s.Fragment,{children:[s.jsx(S,{className:"h-5 w-5"}),"Comments"]})})}),s.jsxs(w,{className:"space-y-4",children:[s.jsx("div",{className:"max-h-60 space-y-4 overflow-y-auto pr-2",children:o.length>0?o.map(e=>s.jsxs("div",{className:"pl-1.5 pt-1.5 flex items-start gap-3",children:[s.jsx(y,{user:e.user,className:"h-8 w-8"}),s.jsxs("div",{className:"flex-1 rounded-md bg-muted p-3 text-sm shadow backdrop-blur-lg",children:[s.jsx("p",{className:"font-semibold text-primary",children:e.user.name}),s.jsx("p",{className:"whitespace-pre-wrap",children:e.comment}),e.is_initial&&s.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Initial problem description"})]})]},e.id)):s.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"No comments yet."})}),s.jsxs("form",{onSubmit:p,className:"space-y-2 border-t-2 border-primary pt-4",children:[s.jsxs(s.Fragment,{children:[s.jsx(v,{className:"ring-1 hover:ring-primary",placeholder:"Add a comment...",value:m.comment,onChange:e=>i("comment",e.target.value)}),s.jsx(f,{message:l.comment})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs(g,{size:"sm",disabled:n,className:"hover:bg-primary/60",children:[s.jsx(C,{}),n?"Posting...":"Post comment"]})})]})]})]})}export{$ as DiscussionCard};
